import{_ as F,e as _,g as P,y as R,z as U,h as M,E as l,A as Q,c as v,b as o,w as n,r as d,u as A,o as y,a as t,x as L,n as i,i as I,B as j,C as G,d as g,D as H}from"./index-QFnM3oiv.js";const J={class:"pay-container"},K={key:0,class:"pay-content"},W={class:"order-info"},X={class:"order-item"},Y={class:"value"},Z={class:"order-item"},ee={class:"value"},te={class:"order-item"},se={class:"value price"},oe={class:"order-item"},ae={class:"value"},re={class:"pay-method"},ne={class:"pay-method-item"},le={class:"pay-method-item"},de={key:0,class:"qrcode-container"},ie={class:"qrcode"},ue={class:"countdown"},ce={class:"countdown-time"},pe={class:"pay-actions"},me={key:1,class:"empty-state"},_e={__name:"PayView",setup(ve){const p=M(),b=A(),a=_(null),u=_(2),m=_(600),h=_(100);let c=null;const k=P(()=>u.value===2?"请使用支付宝扫描二维码支付":"请使用微信扫描二维码支付"),f=s=>u.value===2?`https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=https://www.alipay.com&orderId=${s}`:`https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=https://www.weixin.qq.com&orderId=${s}`;R(u,(s,e)=>{a.value&&(a.value.payImage=f(a.value.orderId),l.info(s===2?"已切换到支付宝支付":"已切换到微信支付"))});const V=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",D=async(s,e)=>{try{const r="ORD"+Date.now();a.value={orderId:r,appItem:s,price:parseFloat(e),realPrice:parseFloat(e),createTime:new Date().toISOString(),payImage:f(r)},l.success("订单创建成功")}catch(r){l.error("创建订单失败："+r.message)}},T=async()=>{try{const s=p.query.orderId;if(!s)throw new Error("订单号不能为空");a.value={orderId:s,appItem:"测试商品",price:100,createTime:new Date().toISOString(),payImage:f(s)}}catch(s){l.error("查询订单失败："+s.message)}},O=async()=>{try{l.success("支付成功"),b.push({path:"/pay/success",query:{orderId:a.value.orderId}})}catch(s){l.error("查询支付结果失败："+s.message)}},q=async()=>{try{l.success("订单已关闭"),a.value=null}catch(s){l.error("关闭订单失败："+s.message)}},S=()=>{c=setInterval(()=>{m.value--,h.value=m.value/600*100,m.value<=0&&(clearInterval(c),q())},1e3)},N=()=>{c&&(clearInterval(c),c=null)};return U(()=>{const s=p.query.orderId,e=p.query.item,r=p.query.price;s?T():e&&r?D(e,r):l.warning("订单信息不完整"),S()}),Q(()=>{N()}),(s,e)=>{const r=d("el-icon"),C=d("el-radio"),z=d("el-radio-group"),B=d("el-image"),E=d("el-progress"),w=d("el-button"),$=d("el-card");return y(),v("div",J,[o($,{shadow:"hover",class:"pay-card"},{default:n(()=>[e[14]||(e[14]=t("div",{class:"pay-header"},[t("h2",null,"订单支付")],-1)),a.value?(y(),v("div",K,[t("div",W,[t("div",X,[e[2]||(e[2]=t("span",{class:"label"},"订单号：",-1)),t("span",Y,i(a.value.orderId),1)]),t("div",Z,[e[3]||(e[3]=t("span",{class:"label"},"商品名称：",-1)),t("span",ee,i(a.value.appItem),1)]),t("div",te,[e[4]||(e[4]=t("span",{class:"label"},"支付金额：",-1)),t("span",se,"¥"+i(a.value.price.toFixed(2)),1)]),t("div",oe,[e[5]||(e[5]=t("span",{class:"label"},"创建时间：",-1)),t("span",ae,i(V(a.value.createTime)),1)])]),t("div",re,[e[8]||(e[8]=t("h3",null,"请选择支付方式",-1)),o(z,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=x=>u.value=x)},{default:n(()=>[o(C,{label:2},{default:n(()=>[t("div",ne,[o(r,null,{default:n(()=>[o(I(j))]),_:1}),e[6]||(e[6]=t("span",null,"支付宝",-1))])]),_:1}),o(C,{label:3},{default:n(()=>[t("div",le,[o(r,null,{default:n(()=>[o(I(G))]),_:1}),e[7]||(e[7]=t("span",null,"微信支付",-1))])]),_:1})]),_:1},8,["modelValue"])]),a.value.payImage?(y(),v("div",de,[t("h3",null,i(k.value),1),t("div",ie,[o(B,{src:a.value.payImage,style:{width:"250px",height:"250px"},fit:"cover"},null,8,["src"])]),t("div",ue,[t("span",null,[e[9]||(e[9]=g("订单将在 ",-1)),t("span",ce,i(m.value)+" 秒后过期",1)])]),o(E,{percentage:h.value,"stroke-width":6,status:"warning"},null,8,["percentage"])])):L("",!0),t("div",pe,[o(w,{type:"primary",onClick:O},{default:n(()=>[...e[10]||(e[10]=[g("查询支付结果",-1)])]),_:1}),o(w,{onClick:q},{default:n(()=>[...e[11]||(e[11]=[g("关闭订单",-1)])]),_:1})])])):(y(),v("div",me,[o(r,{class:"empty-icon"},{default:n(()=>[o(I(H))]),_:1}),e[13]||(e[13]=t("p",null,"订单不存在或已失效",-1)),o(w,{type:"primary",onClick:e[1]||(e[1]=x=>s.$router.push("/"))},{default:n(()=>[...e[12]||(e[12]=[g("返回首页",-1)])]),_:1})]))]),_:1})])}}},ge=F(_e,[["__scopeId","data-v-a45de715"]]);export{ge as default};
